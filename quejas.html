<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buz贸n de Quejas</title>
  <style>
    :root{
      --primary:#0b7fbf;
      --accent:#ff7a59;
      --bg: rgb(220,220,220);;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --radius:14px;
    }

    *{box-sizing:border-box}
    body{
      font-family:Inter, system-ui, -apple-system;
      margin:0;
      background:var(--bg);
      color:var(--text);
    }

    header{
      background:linear-gradient(90deg,var(--primary),#0f9bd6);
      color:white;
      padding:22px 16px;
      text-align:center;
    }
    header h1{margin:0 0 4px;font-size:24px}
    header p{margin:0;font-size:14px}

    .container{
      max-width:980px;
      margin:20px auto;
      padding:0 16px;
    }

    nav{
      display:flex;
      gap:10px;
      overflow-x:auto;
      padding-bottom:8px;
      scrollbar-width:none;
    }
    nav::-webkit-scrollbar{display:none;}

    .tab{
      background:var(--card);
      padding:10px 14px;
      border-radius:12px;
      white-space:nowrap;
      box-shadow:0 1px 4px rgba(2,6,23,0.06);
      font-weight:600;
      text-decoration:none;
      color:var(--text);
      flex-shrink:0;
      font-size:14px;
    }

    main{
      display:grid;
      grid-template-columns:1fr 360px;
      gap:20px;
    }

    @media(max-width:900px){
      main{grid-template-columns:1fr}
    }

    .card{
      background:var(--card);
      padding:18px;
      border-radius:var(--radius);
      box-shadow:0 6px 20px rgba(11,127,191,0.06);
    }

    h2{margin-top:0}

    label{display:block;font-weight:600;margin-bottom:6px}
    .field{margin-bottom:14px}

    input[type="text"], input[type="email"], textarea{
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid #e6eef8;
      font-size:16px;
    }

    textarea{min-height:150px}

    .actions{
      display:flex;
      gap:10px;
      margin-top:5px;
    }

    button{
      background:var(--primary);
      color:white;
      border:none;
      padding:12px 16px;
      border-radius:12px;
      font-weight:700;
      font-size:15px;
      cursor:pointer;
      flex:1;
    }

    button.secondary{
      background:#eef6fb;
      color:var(--primary);
      flex:1;
    }

    .list{
      max-height:420px;
      overflow-y:auto;
      padding:6px;
    }
    .item{
      border:1px solid #eef6fb;
      padding:10px;
      border-radius:10px;
      margin-bottom:8px;
      background:#fff;
    }
    .meta{
      font-size:12px;
      color:var(--muted);
      margin-bottom:5px;
    }
    .empty{
      color:var(--muted);
      text-align:center;
      padding:20px;
    }

    .toast{
      position:fixed;
      right:16px;
      bottom:16px;
      background:var(--primary);
      color:white;
      padding:12px 16px;
      border-radius:12px;
      box-shadow:0 8px 30px rgba(11,127,191,0.16);
      display:none;
      font-size:14px;
    }
    .banimg{
    display: block;
    max-width: 100%;
    height: auto;
    }
  </style>
</head>
<body>
  <header>
    <img class="banimg" src="ima/newban.jpg" alt="">
    <h1>buzon de quejas</h1>
    <p>Env铆a tu queja de manera segura y an贸nima.</p>
  </header>

  <div class="container">
    <nav>
      <a class="tab" href="index.html"> Inicio</a>
      <a class="tab" href="contacto.html"> Contacto</a>
    </nav>

    <main>
      <section class="card">
        <h2>Deja tu queja</h2>

        <form id="complaintForm">
          <div class="field">
            <label for="name">Nombre (opcional)</label>
            <input id="name" name="name" type="text" />
          </div>

          <div class="field">
            <label for="email">Correo (opcional)</label>
            <input id="email" name="email" type="email" />
          </div>

          <div class="field">
            <label for="message">Queja / Comentario</label>
            <textarea id="message" name="message" required></textarea>
          </div>

          <div class="actions">
            <button type="submit">Enviar</button>
            <button type="button" class="secondary" id="clearBtn">Limpiar</button>
          </div>
        </form>
      </section>

      <aside class="card">
        <h3>Quejas recibidas</h3>
        <div class="list" id="submissions">
          <div class="empty">No hay quejas a煤n.</div>
        </div>
        <div class="actions" style="margin-top:10px;">
          <button id="exportBtn" class="secondary">Exportar JSON</button>
          <button id="clearAllBtn" class="secondary">Borrar todo</button>
        </div>
      </aside>
    </main>
  </div>

  <div class="toast" id="toast">隆Queja enviada y enviada al correo!</div>

  <script>
    const form = document.getElementById('complaintForm');
    const submissionsEl = document.getElementById('submissions');
    const toast = document.getElementById('toast');
    const LOCAL_KEY = 'buzon_quejas_v1';

    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyxiGAXyK-u_B3cOOmB6_ZL4uyiPNJbbI0lBakVIY8B10nKyeD6wsxQ4ZvKf2Pljxhsuw/exec";

    function load(){
      const raw = localStorage.getItem(LOCAL_KEY);
      return raw ? JSON.parse(raw) : [];
    }
    function save(list){
      localStorage.setItem(LOCAL_KEY, JSON.stringify(list));
    }

    function render(){
      const list = load();
      submissionsEl.innerHTML = '';
      if(!list.length){
        submissionsEl.innerHTML = '<div class="empty">No hay quejas a煤n.</div>';
        return;
      }
      list.slice().reverse().forEach((s)=>{
        const item = document.createElement('div');
        item.className = 'item';
        item.innerHTML = `
          <div class="meta">${s.name ? s.name+' 路 ' : ''}${s.email ? s.email+' 路 ' : ''}${new Date(s.ts).toLocaleString()}</div>
          <div>${s.message}</div>
        `;
        submissionsEl.appendChild(item);
      });
    }

    function showToast(){
      toast.style.display = "block";
      setTimeout(()=> toast.style.display = "none", 2500);
    }

    form.addEventListener('submit', async e=>{
      e.preventDefault();
      const name = form.name.value.trim();
      const email = form.email.value.trim();
      const message = form.message.value.trim();

      if(message.length < 3){
        alert("Debes escribir una queja.");
        return;
      }

      const entry = {name,email,message,ts:Date.now()};
      const list = load();
      list.push(entry);
      save(list);
      render();

      // Enviar al correo v铆a Apps Script
      fetch(SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        body: new FormData(form)
      });

      form.reset();
      showToast();
    });

    document.getElementById('clearBtn').onclick = ()=> form.reset();

    document.getElementById('clearAllBtn').onclick = ()=>{
      if(confirm("驴Borrar todas las quejas?")){
        localStorage.removeItem(LOCAL_KEY);
        render();
      }
    };

    document.getElementById('exportBtn').onclick = ()=>{
      const list = load();
      const blob = new Blob([JSON.stringify(list, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "quejas.json";
      a.click();
    };

    render();
  </script>
</body>
</html>
